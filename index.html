<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Block Bust - Firebase Leaderboard</title>
  <style>
    :root{--bg:#0f1724;--panel:#081126;--accent:#38bdf8;--muted:#94a3b8}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#071126);color:#e6eef8}
    .wrap{max-width:900px;margin:28px auto;padding:18px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.08));box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:10px;align-items:center}
    button{background:transparent;border:1px solid rgba(255,255,255,0.08);color:inherit;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.primary{background:var(--accent);color:#042939;border:none}
    .hud{display:flex;gap:12px;align-items:center;font-size:14px;color:var(--muted)}
    canvas{display:block;margin:18px auto;border-radius:8px;background:linear-gradient(180deg,#07203a, #031423);box-shadow:0 8px 24px rgba(2,6,23,0.6)}
    .help{font-size:13px;color:var(--muted);margin-top:8px}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:var(--muted);font-size:13px}
    .touch-bar{display:none}
    @media (max-width:600px){.wrap{margin:10px;padding:12px}.touch-bar{display:flex;gap:8px;justify-content:center;margin-top:10px}.touch-btn{padding:12px 18px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);cursor:pointer}}
    #leaderboard{margin-top:20px;padding:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:8px}
    #leaderboard h2{margin:0 0 10px;font-size:16px;color:var(--accent)}
    #leaderboard ol{margin:0;padding:0 0 0 20px;font-size:14px}
  </style>
  <!-- Firebase -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
    import { getDatabase, ref, set, push, get, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD8GjErV4ABo6U21bwabszwuwxAfcLNvHg",
      authDomain: "game-34-d1383.firebaseapp.com",
      projectId: "game-34-d1383",
      storageBucket: "game-34-d1383.appspot.com",
      messagingSenderId: "1061146100490",
      appId: "1:1061146100490:web:37cf28ebae47d59418b0f3",
      measurementId: "G-41KLVN1P8L"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function saveScore(name, score) {
      const scoresRef = ref(db, 'scores');
      const newScoreRef = push(scoresRef);
      set(newScoreRef, { name, score, timestamp: Date.now() });
    }

    async function getTopScores() {
      const scoresRef = ref(db, 'scores');
      const topScoresQuery = query(scoresRef, orderByChild('score'), limitToLast(5));
      const snapshot = await get(topScoresQuery);
      const scores = [];
      if(snapshot.exists()){
        snapshot.forEach(childSnap=>{
          scores.push(childSnap.val());
        });
        scores.sort((a,b)=>b.score - a.score);
      }
      return scores;
    }

    window.saveScore = saveScore;
    window.getTopScores = getTopScores;
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Block Bust</h1>
      <div class="controls">
        <div class="hud">Score: <span id="score">0</span></div>
        <div class="hud">Lives: <span id="lives">3</span></div>
        <div class="hud">Level: <span id="level">1</span></div>
        <button id="start" class="primary">Start / Resume</button>
        <button id="restart">Restart</button>
      </div>
    </header>

    <canvas id="game" width="800" height="500"></canvas>

    <div class="help">Controls: ← → or A/D to move. Space to launch ball / pause.</div>

    <div id="leaderboard">
      <h2>Leaderboard</h2>
      <ol id="leaderList"></ol>
    </div>
  </div>

  <script>
    // Simple paddle & ball setup (similar to previous Block Bust)
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let score = 0;

    function updateLeaderboardDisplay(){
      getTopScores().then(scores=>{
        const list = document.getElementById('leaderList');
        list.innerHTML = '';
        scores.forEach(s=>{
          const li = document.createElement('li');
          li.textContent = `${s.name}: ${s.score}`;
          list.appendChild(li);
        });
      });
    }

    function endGame(){
      const name = prompt('Game Over! Enter your name:','Player');
      if(name){
        saveScore(name, score);
        updateLeaderboardDisplay();
      }
    }

    // Placeholder: simulate game ending after 5 seconds
    setTimeout(()=>{
      score = Math.floor(Math.random()*2000); // example score
      endGame();
    },5000);

    // Initial leaderboard load
    updateLeaderboardDisplay();
  </script>
</body>
</html>
